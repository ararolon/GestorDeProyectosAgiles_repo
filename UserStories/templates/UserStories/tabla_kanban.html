{% extends 'SSO/base_usuarios.html' %}
{% load crispy_forms_tags %}
{%  load static %}
{% block title %}Nuevo Estado Kanban{% endblock %}
{% block content %}

<div class="row">
    <h2 
        class="col-12 col-md-10">Tabla Kanban
    </h2>
</div>
<hr>

{% for tipo in tipos %}
<h3>{{tipo.nombre}}</h3>
<div class="container-fluid pb-5" style="overflow-x: scroll;">
    <div class="row flex-row flex-sm-nowrap py-3">
        {% for estado in tipo.estados_kanban.all|dictsort:"id" %}
            <div class="col-sm-6 col-md-4 col-xl-3">
                <div class="card bg-light">
                    <div class="card-body" style="min-height: 200px;">
                        <h6 class="card-title text-uppercase text-truncate py-2" style="color: rgb(29, 82, 47)">{{estado}}</h6>
                        {% for userstory in userstories %}
                        {% if tipo == userstory.tipo and userstory.estado == estado %}
                            <div class="items border border-light">
                                <div class="card draggable shadow-sm" id="cd1" draggable="true" ondragstart="drag(event)">
                                    <div class="card-body p-2">
                                        <div class="card-title">
                                            <h5 style="color: rgb(8, 160, 59)">
                                                {{userstory.nombre}}
                                            </h5>
                                        </div>
                                        <p>
                                            {{userstory.descripcion}}
                                        </p>
                                        <button onclick="document.getElementById('us-{{userstory.id_us}}').classList.toggle('show');" class="btn btn-secundary btn-sm" style="color: rgb(25, 59, 182)" >Cambiar estado</button>
                                        <div class="collapse" id="us-{{userstory.id_us}}">
                                            <div class="row">
                                                {% for estado in tipo.estados_kanban.all %} 
                                                    {% if not userstory.estado == estado %}
                                                        <a href="{% url 'cambiarEstado' userstory.id_us estado.id %}" class="ml-3 bg-color-danger border-0">{{estado}}</a>
                                                    {% endif %}
                                                {% endfor %}
                                            </div>
                                        </div>   
                                    </div>
                                </div>
                            </div> 
                            {% endif %} 
                        {% endfor %}
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
</div>
{% endfor %}
{% endblock %}
